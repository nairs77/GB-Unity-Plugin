#if UNITY_ANDROID
using UnityEngine;
using System;
using Joycity;

namespace Joycity.PlayGameService {
	public class GPGClient : JoypleAndroidHelper, IPlayGameClient {
		
		private static readonly string NATIVE_GPG_CLASS_PACKAGE = "com.joycity.platform.unity.GPGPlugin";

		private static readonly string GET_IS_LOGIN = "IsAuthenticated";
				
		private static AndroidJavaClass _androidGPGHelper;
		private static AndroidJavaClass AndroidGPGHelper {
			get {
				if (_androidGPGHelper == null) {
					_androidGPGHelper = new AndroidJavaClass(NATIVE_GPG_CLASS_PACKAGE);
				}
				return _androidGPGHelper;
			}
		}
		
		public void SignIn(JoypleRequest callbackObject) {
			UnityActivity.Call("runOnUiThread", new AndroidJavaRunnable(() => {
				AndroidGPGHelper.CallStatic("SignIn", callbackObject.GetCallbackGameObjectName());
		  	}));
		}
		
		public void SignOut(JoypleRequest callbackObject) {
			UnityActivity.Call("runOnUiThread", new AndroidJavaRunnable(() => {
				AndroidGPGHelper.CallStatic("SignOut", callbackObject.GetCallbackGameObjectName());
		  	}));
		}
		
		public bool IsAuthenticated() {
			return AndroidGPGHelper.CallStatic<bool> (GET_IS_LOGIN);			
		}
		public void ShowLeaderboardUI(string leaderboardId, JoypleRequest callbackObject) {
			UnityActivity.Call("runOnUiThread", new AndroidJavaRunnable(() => {
				AndroidGPGHelper.CallStatic("ShowLeaderboardUI", leaderboardId, callbackObject.GetCallbackGameObjectName());
		  	}));			
		}
		
		public void ShowAchievementsUI(JoypleRequest callbackObject) {
			UnityActivity.Call("runOnUiThread", new AndroidJavaRunnable(() => {
				AndroidGPGHelper.CallStatic("ShowAchievementsUI", callbackObject.GetCallbackGameObjectName());
		  	}));			
		}
		
		public void ReportProgress(string achId, double step, JoypleRequest callbackObject) {
			UnityActivity.Call("runOnUiThread", new AndroidJavaRunnable(() => {
				string strStep = Convert.ToString(step);
				AndroidGPGHelper.CallStatic("ReportProgress", achId, strStep, callbackObject.GetCallbackGameObjectName());
		  	}));						
		}
		/*
		public void IncrementAchievement(string resID, int step, JoypleRequest callbackObject) {
			UnityActivity.Call("runOnUiThread", new AndroidJavaRunnable(() => {
				AndroidGPGHelper.CallStatic("IncrementAchievement", resID, step, callbackObject.GetCallbackGameObjectName());
		  	}));			
		}		
		*/
		public void FetchQuestById(string questId, JoypleRequest callbackObject) {
			UnityActivity.Call("runOnUiThread", new AndroidJavaRunnable(() => {
				AndroidGPGHelper.CallStatic("FetchQuestById", questId, callbackObject.GetCallbackGameObjectName());
			}));
		}
		
		public void ShowAllQuestsUI(JoypleRequest callbackObject) {
			UnityActivity.Call("runOnUiThread", new AndroidJavaRunnable(() => {
				AndroidGPGHelper.CallStatic("ShowAllQuestsUI", callbackObject.GetCallbackGameObjectName());
			}));			
		}
		
		public void SubmitScore(long score, string leaderBoardId, JoypleRequest callbackObject) {
			UnityActivity.Call("runOnUiThread", new AndroidJavaRunnable(() => {
				AndroidGPGHelper.CallStatic("SubmitScore", score, leaderBoardId, callbackObject.GetCallbackGameObjectName());
			}));			
		}
		
		public void IncrementEvent(string eventId, uint stepsToIncrement) {
			AndroidGPGHelper.CallStatic("IncrementEvent", eventId, (int)stepsToIncrement);
		}		
		//  public void IncrementAchievement(string achID, JoypleRequest callbackObject) {
		//  	UnityActivity.Call("runOnUiThread", new AndroidJavaRunnable(() => {
		//  		AndroidGPGHelper.CallStatic("FetchEvent", achID, callbackObject.GetCallbackGameObjectName());
		//  	}));
		//  }
		public void ClaimMilestone(IQuestMilestone milestone, JoypleRequest callbackObject) {
			UnityActivity.Call("runOnUiThread", new AndroidJavaRunnable(() => {
				AndroidGPGHelper.CallStatic("ClaimMilestone", milestone.QuestId, milestone.Id, callbackObject.GetCallbackGameObjectName());
			}));						
		}		
	}
}
#endif
